# Technical Overview of Lifecycle Management.md

## Technical Overview of Lifecycle Management

## Overview
- Recognize and recall the features and functions that are available with the latest release of VMware Cloud Foundation, including:
- Downloading and applying installation and upgrade bundles 
- How to apply critical fixes using the Async Patch tool 
- Improvements to vSphere Lifecycle Manager Images 
- ESXi Host Upgrade Options 
- NSX upgrade enhancements
- How to configure a proxy server 
- How to use the offline bundle transfer utility

## Notes
- VCF Simplifies Operations and Reduces Risk
- With VCF, available updates for all components are tested for interoperability and then bundled with the necessary logic for proper installation order. And, the whole process is completely automated!  
- Updates are applied on a per workload domain basis. ESXi updates can further be applied on a per cluster basis, or even at a per-host level (using the API). 
- Ease of Upgrades and Patching
   - Update Notification
   - Review updates
   - Pre-check
   - Schedule updates
   - monitoring and reporting
- Cloud Foundation Bundles
   - Update bundles are aligned to a specific VCF Bill of Materials (BOM)
   - Components of VCF Update Bundles include the following: SDDC Manager, vCenter Server, ESXi, vSAN, NSX, and VMware Aria Lifecycle. VMware Aria Suite products, and Workspace ONE Access are lifecycle managed using VMware Aria Lifecycle.
- Two Types of Bundles
   - Update bundles are used to update/upgrade the separate SDDC software components for existing workload domains.  
   - Install bundles are used to deploy new workload domains following a VCF upgrade.   
- updates to a VCF instance must be applied using the 
   - SDDC Manager 
   - Async Patch Tool (discussed below)
      - The Async Patch (AP) Tool is a command-line utility that allows administrators to apply critical patches to VCF components that are released outside of a VCF release.  
      - The AP Tool is also used to upgrade an async patched system to a newer VCF version.
      - Use the Async Patch Tool to download the desired update and upload it to the internal LCM repository on the SDDC Manager.
      - Log in to the SDDC Manager User Interface (UI) and apply the Async Patch to all workload domains.
      - After an Async Patch has been applied, the software build number for one or more of the SDDC components will deviate from the SDDC Manager Bill of Materials (BOM). When this happens, you may need to continue to use the Async Patch CLI tool to apply future updates until such time that the software build numbers are brought back in alignment with the SDDC Manager BOM.
- Skip Level Upgrades can be driven from SDDC Manager. You can schedule a single maintenance window and update to the desired state in a single action, saving a lot of time in the process.
- Prechecks
   - LCM Pre-Checks are used to validate the health of a workload domain. It is recommended that you always run a pre-check before applying any software updates to the SDDC.
   - SDDC Manager Pre-Check
      - A full pre-check of all components in a workload domain.
   - SDDC Manager Context Aware Pre-Check
      - Requires VCF SDDC Manager 5.0+
      - A targeted pre-check for select components within a domain
   - If a pre-check shows an error or warning it is likely that an upgrade may fail and require additional troubleshooting.
   - Download Updated Pre-Check Files
- Host Patching and Upgrade Options
   -  In a VCF deployment, vLCM is managed through SDDC Manager and not through vCenter Server.
   - vLCM Baselines (Legacy - to be deprecated)
      - A vLCM baseline is a grouping of multiple updates.
      - Perform upgrades and patch ESXi hosts
      - Install and update 3rd party software (VIBS)
      - A vLCM baseline can be configured at a per-host level
   - vLCM Images
      - A vLCM image represents a desired state software specification to be applied to all hosts in a cluster. A vLCM image is a combination of components to define the full software stack that you want to run on all hosts in a cluster.
      - Desired state model
      - monitors compliance drift
      - manages hosts at cluster level, including hypervisor, drivers, firmware, vendor firmware plugins
      - Install a desired ESXi version on all hosts in a cluster.
      - Install and update third-party software on all ESXi hosts in a cluster.
      - Update and upgrade the ESXi version on all hosts in a cluster.
      - Update the firmware of all ESXi hosts in a cluster.
      - Generate recommendations and use a recommended image for your cluster or host.
      - Check the hardware compatibility of hosts and clusters against the VMware Compatibility Guide and the vSAN Hardware Compatibility List.
      - A vLCM image is applied at a per-cluster level

   - vLCM Options for the Management Domain
      - use vLCM images or vLCM baselines
   - vLCM Options for Workload Domains
      - The choice for using vLCM images or vLCM baselines for workload domains is made at the time a domain is created.
   - vSAN Stretched clusters can only be configured with vLCM baselines. 
   - When using vSphere Replication, the use of vLCM baselines is required.
   - Hosts configured with NVIDIA vGPU devices need to reside within a workload domain configured to use vLCM images.
   - Hosts configured as 2-node clusters that use NFS/FC/vVols as principal storage need to be configured in a workload domain    - configured to use vLCM images. This also applies to both local and remote clusters.
   - NSX Instances cannot be shared between domains configured using a vLCM baseline and a vLCM image.
   - With mixed-mode support, administrators can update the management domain and one or more workload domain to the latest version without the need to upgrade all workload domains.
- ESXi hosts can be updated sequentially (one after another) in a specific order. 
   - Sequential ESXi host updates help to make upgrades controlled and predictable.
- ESXi components can also be upgraded in parallel (at the same time).  
   - Parallel updates help to reduce the downtime by allowing multiple hosts to be upgraded concurrently. 
   - By default, all clusters are configured to upgrade ESXi hosts in parallel. To upgrade clusters sequentially, select the “Enable Sequential Cluster Upgrade” option within the SDDC Manager when upgrading the cluster.
   - VCF supports upgrades/patching of up to five workload domains with each containing up to 10 clusters each in parallel (at the same time).
- NSX Upgrades
   - sequential upgrades provide more control and help to make the upgrades more predictable.
   - Parallel upgrades are optimized to reduce downtime.
   - NSX upgrade Sequence
      - NSX fabric updates are applied by upgrading the NSX Upgrade Coordinator.
      - NSX Edge clusters are upgraded next and need to be updated before the host clusters.
      - Upgrade the host clusters
      - NSX Manager clusters are the final components to be upgraded in this sequence.
- Proxy Server in SDDC manager
   - To manually configure a proxy server for bundle downloads, this file needs to be edited:
      - **/opt/vmware/vcf/lcm/lcm-app/conf/application-prod.properties**
- Online upgrades
   - When customers have an environment in which SDDC Manager can access the internet, VCF administrators simply authenticate using their VMware Customer Connect credentials
   - VMware Depot is hosted with Akamai content distribution network, therefore there isn’t a dedicated IP address, so customers should whitelist the DNS name for outbound communication.
- Offline Lifecycle Management
   - With this method, a workstation can be used to download available updates using a CLI command and then transfer them to the SDDC Manager. The customer can then apply each update individually by clicking Update Now within SDDC Manager or they can schedule the update to run at any time to align with their change management window.
   
## Stopping Spot
- 